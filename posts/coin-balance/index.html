<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Coin balance | Pythonicity</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="../../assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../rss.xml">
<link rel="canonical" href="https://coady.github.io/posts/coin-balance/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="A. Coady">
<link rel="prev" href="../hat-puzzle/" title="Hat puzzle" type="text/html">
<link rel="next" href="../water-pouring/" title="Water pouring" type="text/html">
<meta property="og:site_name" content="Pythonicity">
<meta property="og:title" content="Coin balance">
<meta property="og:url" content="https://coady.github.io/posts/coin-balance/">
<meta property="og:description" content="How to solve the coin balance puzzle programmatically.¶Given a balance and a set of coins, which are all equal in weight except for one, determine which coin is of different weight in as few weighings">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2020-06-07T00:00:00-07:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Header and menu bar -->
<div class="container">
      <header class="blog-header py-3"><div class="row nbb-header align-items-center">
          <div class="col-md-3 col-xs-2 col-sm-2" style="width: auto;">
            <button class="navbar-toggler navbar-light bg-light nbb-navbar-toggler" type="button" data-toggle="collapse" data-target=".bs-nav-collapsible" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse bs-nav-collapsible bootblog4-search-form-holder">
                
            </div>
        </div>
          <div class="col-md-6 col-xs-10 col-sm-10 bootblog4-brand" style="width: auto;">
            <a class="navbar-brand blog-header-logo text-dark" href="../../">

            <span id="blog-title">Pythonicity</span>
        </a>
          </div>
            <div class="col-md-3 justify-content-end align-items-center bs-nav-collapsible collapse flex-collapse bootblog4-right-nav">
            <nav class="navbar navbar-light bg-white"><ul class="navbar-nav bootblog4-right-nav">
<li class="nav-item">
    <a href="index.ipynb" id="sourcelink" class="nav-link">Source</a>
    </li>


                    
            </ul></nav>
</div>
    </div>
</header><nav class="navbar navbar-expand-md navbar-light bg-white static-top"><div class="collapse navbar-collapse bs-nav-collapsible" id="bs-navbar">
            <ul class="navbar-nav nav-fill d-flex w-100">
<li class="nav-item">
<a href="../../archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="../../categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="../../rss.xml" class="nav-link">RSS feed</a>
                </li>
<li class="nav-item">
<a href="https://github.com/coady/coady.github.io" class="nav-link">Source</a>

                
            </li>
</ul>
</div>
<!-- /.navbar-collapse -->
</nav>
</div>

<div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Coin balance</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    A. Coady
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2020-06-07T00:00:00-07:00" itemprop="datePublished" title="2020-06-07">2020-06-07</time></a>
            </p>
            
        <p class="sourceline"><a href="index.ipynb" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-solve-the-coin-balance-puzzle-programmatically.">How to solve the coin <a href="https://en.wikipedia.org/wiki/Balance_puzzle#Twelve-coin_problem">balance puzzle</a> programmatically.<a class="anchor-link" href="#How-to-solve-the-coin-balance-puzzle-programmatically.">¶</a>
</h2>
<p>Given a balance and a set of coins, which are all equal in weight except for one, determine which coin is of different weight in as few weighings as possible.</p>
<blockquote>
<p>Twelve-coin problem</p>
<p>A more complex version has twelve coins, eleven or twelve of which are identical. If one is different, we don't know whether it is heavier or lighter than the others. This time the balance may be used three times to determine if there is a unique coin—and if there is, to isolate it and determine its weight relative to the others. (This puzzle and its solution first appeared in an article in 1945.[2]) The problem has a simpler variant with three coins in two weighings, and a more complex variant with 39 coins in four weighings.</p>
</blockquote>
<p>First to model the data:</p>
<ul>
<li>An <code>enum</code> to represent different weights.  Following the ternary comparison convention, such as Python 2's <a href="https://docs.python.org/2.7/library/functions.html?highlight=cmp#cmp">cmp</a>, is convenient.</li>
<li>An object to represent the balance.  For testing, it will need to be configurable with the target coin and relative weight.</li>
<li>An object to represent a coin and its state.  A <code>class</code> is tempting, but the most useful data structure would keep the coins grouped by their known (or unknown) state anyway.  So any hashable unique identifier is sufficient.</li>
</ul>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">enum</span>

<span class="k">class</span> <span class="nc">Weight</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntEnum</span><span class="p">):</span>
    <span class="n">LIGHT</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">EVEN</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">HEAVY</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">class</span> <span class="nc">Balance</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coin</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">Weight</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coin</span> <span class="o">=</span> <span class="n">coin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span>

    <span class="k">def</span> <span class="nf">weigh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">:</span> <span class="nb">set</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">set</span><span class="p">):</span>
        <span class="sd">"""Return relative Weight of left side to right side."""</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">right</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coin</span> <span class="ow">in</span> <span class="n">left</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coin</span> <span class="ow">in</span> <span class="n">right</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Weight</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Weight</span><span class="o">.</span><span class="n">EVEN</span>

<span class="n">coins</span> <span class="o">=</span> <span class="s1">'abcdefghijkl'</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">coins</span><span class="p">)</span> <span class="o">==</span> <span class="mi">12</span>
<span class="n">balance</span> <span class="o">=</span> <span class="n">Balance</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="n">Weight</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">balance</span><span class="o">.</span><span class="n">weigh</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">)</span> <span class="o">==</span> <span class="n">Weight</span><span class="o">.</span><span class="n">LIGHT</span>
<span class="k">assert</span> <span class="n">balance</span><span class="o">.</span><span class="n">weigh</span><span class="p">(</span><span class="s1">'b'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">)</span> <span class="o">==</span> <span class="n">Weight</span><span class="o">.</span><span class="n">EVEN</span>
<span class="k">assert</span> <span class="n">balance</span><span class="o">.</span><span class="n">weigh</span><span class="p">(</span><span class="s1">'b'</span><span class="p">,</span> <span class="s1">'a'</span><span class="p">)</span> <span class="o">==</span> <span class="n">Weight</span><span class="o">.</span><span class="n">HEAVY</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>As is typical with <a href="https://en.wikipedia.org/wiki/Induction_puzzles">induction puzzles</a>, the constants chosen are just large enough to thwart an iterative approach.  The 2 weighing variation would be trivial enough for most people to brute force the solution.  Whereas 4 weighings would already be such a large decision tree, it would be tedious to even output.  The easier approach is solve the puzzle recursively and more generally, for any number of coins and weighings.</p>
<p>So what can be done in a single weighing?  Clearly all weighings must have an equal number of coins on each side, else nothing is learned.  If it balances, then the different coin is in the unweighed group.  If it doesn't balance, then the different coin is in the weighed group, but additionally it is known whether each coin would be heavy or light based on which side it was on.  This is the crucial insight: there's a variant recursive puzzle embedded inside this puzzle.</p>
<p>The <a href="https://en.wikipedia.org/wiki/Tower_of_Hanoi">Towers of Hanoi</a> is a classic puzzle often used in computer science curricula to teach recursion.  This one would suitable as a subsequent more advanced problem.</p>
<p>So what can be done with known coins in a single weighing?  If it balances, then as before the different coin is in the unweighed group.  But if it doesn't balance, then which way can be used to further narrow the coins.  Consider the heavier side; the different coin must be one of the heavy ones on that side, or one of the light ones on the other side.  Therefore the coins can be split into 2 equal sized groups by putting equal numbers of heavy coins on each side, and equal numbers of light coins on each side.  One obstacle is that if there aren't an even number, there will need to be filler coins just to balance.  But that won't be a problem after the first weighing.</p>
<p>Now we can implement a solution to the sub-problem, and build the need for filler coins into the balance implementation.  A generator is used so that the output of each weighing can be displayed.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">itertools</span>

<span class="k">class</span> <span class="nc">Balance</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coin</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">Weight</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coin</span> <span class="o">=</span> <span class="n">coin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filler</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">weigh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">left</span><span class="p">:</span> <span class="nb">set</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">set</span><span class="p">):</span>
        <span class="sd">"""Return relative Weight of left side to right side."""</span>
        <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">left</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">right</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filler</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coin</span> <span class="ow">in</span> <span class="n">left</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coin</span> <span class="ow">in</span> <span class="n">right</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Weight</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Weight</span><span class="o">.</span><span class="n">EVEN</span>

    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">light</span><span class="p">:</span> <span class="nb">set</span><span class="p">,</span> <span class="n">heavy</span><span class="p">:</span> <span class="nb">set</span><span class="p">):</span>
        <span class="sd">"""Recursively find target coin from sets of potentially light and heavy coins."""</span>
        <span class="k">yield</span> <span class="n">light</span><span class="p">,</span> <span class="n">heavy</span>
        <span class="n">union</span> <span class="o">=</span> <span class="n">light</span> <span class="o">|</span> <span class="n">heavy</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">union</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(),</span> <span class="nb">set</span><span class="p">()</span>
        <span class="c1"># split into 3 groups</span>
        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">third</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="p">(</span><span class="n">light</span><span class="p">,</span> <span class="n">heavy</span><span class="p">):</span>
                <span class="n">third</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weigh</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">weight</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">light</span><span class="p">,</span> <span class="n">heavy</span> <span class="o">=</span> <span class="p">(</span><span class="n">light</span> <span class="o">&amp;</span> <span class="n">left</span><span class="p">),</span> <span class="p">(</span><span class="n">heavy</span> <span class="o">&amp;</span> <span class="n">right</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">weight</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">light</span><span class="p">,</span> <span class="n">heavy</span> <span class="o">=</span> <span class="p">(</span><span class="n">light</span> <span class="o">&amp;</span> <span class="n">right</span><span class="p">),</span> <span class="p">(</span><span class="n">heavy</span> <span class="o">&amp;</span> <span class="n">left</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">light</span><span class="p">,</span> <span class="n">heavy</span> <span class="o">=</span> <span class="p">(</span><span class="n">light</span> <span class="o">-</span> <span class="n">left</span> <span class="o">-</span> <span class="n">right</span><span class="p">),</span> <span class="p">(</span><span class="n">heavy</span> <span class="o">-</span> <span class="n">left</span> <span class="o">-</span> <span class="n">right</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filler</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">union</span> <span class="o">-</span> <span class="n">light</span> <span class="o">-</span> <span class="n">heavy</span><span class="p">)</span>
        <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">light</span><span class="p">,</span> <span class="n">heavy</span><span class="p">)</span>

<span class="n">balance</span> <span class="o">=</span> <span class="n">Balance</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="n">Weight</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">)</span>
<span class="k">for</span> <span class="n">light</span><span class="p">,</span> <span class="n">heavy</span> <span class="ow">in</span> <span class="n">balance</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="s1">'abc'</span><span class="p">),</span> <span class="nb">set</span><span class="p">(</span><span class="s1">'def'</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">light</span><span class="p">),</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">heavy</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>cba dfe
a e
a 
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now with the sub-problem solved, there's just one thing missing for the main puzzle.  In the known case, splitting into 3 equal sized groups is cleary optimal.  But in the unknown case, we need to know how many coins to exclude from the weighing.  This requires computing how many coins can be handled in the subsolution.  Lucikly it's a trivial <a href="https://en.wikipedia.org/wiki/Recurrence_relation">recurrence relation</a>: <code>n</code> weighings can solve 3 times the number of <code>n - 1</code> weighings.
$$
\prod_{}^n 3 = 3^n
$$</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Balance</span><span class="p">(</span><span class="n">Balance</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">coins</span><span class="p">):</span>
        <span class="sd">"""Recursively find target coin."""</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">weigh</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">coins</span><span class="p">,</span> <span class="mi">3</span> <span class="o">**</span> <span class="p">(</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">filler</span><span class="p">)))</span>
        <span class="n">exclude</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">coins</span><span class="p">)</span> <span class="o">-</span> <span class="n">weigh</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">weigh</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weigh</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filler</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">exclude</span> <span class="k">if</span> <span class="n">weight</span> <span class="k">else</span> <span class="n">weigh</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">weight</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">weight</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">left</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">exclude</span><span class="p">)</span>

<span class="n">balance</span> <span class="o">=</span> <span class="n">Balance</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="n">Weight</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">)</span>
<span class="k">for</span> <span class="n">light</span><span class="p">,</span> <span class="n">heavy</span> <span class="ow">in</span> <span class="n">balance</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">coins</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">light</span><span class="p">),</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">heavy</span><span class="p">))</span>

<span class="k">for</span> <span class="n">coin</span> <span class="ow">in</span> <span class="n">coins</span><span class="p">:</span>
    <span class="n">light</span><span class="p">,</span> <span class="n">heavy</span> <span class="o">=</span>  <span class="nb">list</span><span class="p">(</span><span class="n">Balance</span><span class="p">(</span><span class="n">coin</span><span class="p">,</span> <span class="n">Weight</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">coins</span><span class="p">))[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">light</span> <span class="o">==</span> <span class="p">{</span><span class="n">coin</span><span class="p">}</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">heavy</span>
    <span class="n">light</span><span class="p">,</span> <span class="n">heavy</span> <span class="o">=</span>  <span class="nb">list</span><span class="p">(</span><span class="n">Balance</span><span class="p">(</span><span class="n">coin</span><span class="p">,</span> <span class="n">Weight</span><span class="o">.</span><span class="n">HEAVY</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">coins</span><span class="p">))[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">light</span> <span class="ow">and</span> <span class="n">heavy</span> <span class="o">==</span> <span class="p">{</span><span class="n">coin</span><span class="p">}</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>dbah fceg
a e
a 
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The puzzle is solved.  There's one last simplifcation that can be made, but requires a bit more math background.  Ideally we wouldn't need to know the objective number of weighings; the algorithm would just solve any set of coins as efficiently as possible.  To do that, the number of coins that can be solved has to be computed.  As was done above, but this recurrence relation is more advanced: each weighing can solve <code>3 ^ n</code> more coins.
$$
\sum_{k=0}^{n-1} 3^k = (3^n - 1) / 2
$$</p>
<p>With that calculation inverted, the <code>count</code> can be removed from the interface</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>

<span class="k">class</span> <span class="nc">Balance</span><span class="p">(</span><span class="n">Balance</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">solve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coins</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">coins</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coins</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="n">weigh</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">coins</span><span class="p">,</span> <span class="mi">3</span> <span class="o">**</span> <span class="p">(</span><span class="n">count</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">filler</span><span class="p">)))</span>
        <span class="n">exclude</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">coins</span><span class="p">)</span> <span class="o">-</span> <span class="n">weigh</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">right</span> <span class="o">=</span> <span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">weigh</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
        <span class="n">weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weigh</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filler</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">exclude</span> <span class="k">if</span> <span class="n">weight</span> <span class="k">else</span> <span class="n">weigh</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">weight</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">weight</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">right</span><span class="p">,</span> <span class="n">left</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield from</span> <span class="bp">self</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">exclude</span><span class="p">)</span>

<span class="n">balance</span> <span class="o">=</span> <span class="n">Balance</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="n">Weight</span><span class="o">.</span><span class="n">LIGHT</span><span class="p">)</span>
<span class="k">for</span> <span class="n">light</span><span class="p">,</span> <span class="n">heavy</span> <span class="ow">in</span> <span class="n">balance</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">coins</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">light</span><span class="p">),</span> <span class="s1">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">heavy</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>dbah fceg
a e
a 
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Notice the formula indicates it's possible to do 13 coins in 3 weighings, and it would be with a filler coin to balance out the 9 that need weighing.</p>

</div>
</div>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul class="pager hidden-print">
<li class="previous">
                <a href="../hat-puzzle/" rel="prev" title="Hat puzzle">Previous post</a>
            </li>
            <li class="next">
                <a href="../water-pouring/" rel="next" title="Water pouring">Next post</a>
            </li>
        </ul></nav></aside><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'center', // Change this to 'left' if you want left-aligned equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script></article><!--End of body content--><footer id="footer">
            Contents © 2020         <a href="mailto:aric.coady@gmail.com">A. Coady</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
            
        </footer>
</div>
</div>


        <script src="../../assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
